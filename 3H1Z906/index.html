<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0"><link rel="preconnect" href="https://fonts.loli.net" crossorigin><link rel="preconnect" href="https://lib.baomitu.com" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CLato:300,300italic,400,400italic,700,700italic%7C'Noto+Sans':300,300italic,400,400italic,700,700italic%7Csans-serif:300,300italic,400,400italic,700,700italic%7C'Noto+Sans+SC':300,300italic,400,400italic,700,700italic%7CRoboto+Serif:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"1nnoh.top","root":"/","images":"/images","scheme":"Mist","darkmode":"auto","version":"8.13.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"width":269},"copycode":{"enable":false,"style":"flat"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"gitalk":{"order":-1}}},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><link rel="stylesheet" href="/js/prism/prism.css"><meta name="description" content="0x00 Abstract  CAM 类激活热力图：深度学习可解释性分析、显著性分析的经典之作 论文：Learning Deep Features for Discriminative Localization, CVPR 2016，作者：周博磊 主要贡献：奠定了可解释性分析、显著性分析的基石，在此基础上衍生出了一系列的 CAM 方法。帮助我们打开了深度学习的黑箱子。   CAM 是一篇让人拍案叫"><meta property="og:type" content="article"><meta property="og:title" content="可解释机器学习-Task03-CAM类激活热力图"><meta property="og:url" content="https://1nnoh.top/3H1Z906/index.html"><meta property="og:site_name" content="1nnoh&#39;s Blog"><meta property="og:description" content="0x00 Abstract  CAM 类激活热力图：深度学习可解释性分析、显著性分析的经典之作 论文：Learning Deep Features for Discriminative Localization, CVPR 2016，作者：周博磊 主要贡献：奠定了可解释性分析、显著性分析的基石，在此基础上衍生出了一系列的 CAM 方法。帮助我们打开了深度学习的黑箱子。   CAM 是一篇让人拍案叫"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252319417.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252320982.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261121284.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261121284.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261832616.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261839463.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261841218.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252349181.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252351617.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261829054.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261939140.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261943630.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261946654.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261948688.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261950023.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261951559.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261902349.png"><meta property="og:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261906387.png"><meta property="article:published_time" content="2022-12-26T12:02:17.000Z"><meta property="article:modified_time" content="2022-12-26T12:02:17.000Z"><meta property="article:author" content="1nnoh"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252319417.png"><link rel="canonical" href="https://1nnoh.top/3H1Z906/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://1nnoh.top/3H1Z906/","path":"3H1Z906/","title":"可解释机器学习-Task03-CAM类激活热力图"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>可解释机器学习-Task03-CAM类激活热力图 | 1nnoh's Blog</title><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?b20166297c5501f4ebb46c56425f8cb4"></script><script async defer data-website-id="" src=""></script><script defer data-domain="" src=""></script><link rel="stylesheet" href="/js/prism/prism.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">1nnoh's Blog</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#x00-abstract"><span class="nav-text">0x00 Abstract</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x01-cam-%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="nav-text">0x01 CAM 网络结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84"><span class="nav-text">1. 图像分类网络结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cam-%E7%B1%BB%E6%BF%80%E6%B4%BB%E7%83%AD%E5%8A%9B%E5%9B%BE%E8%AE%A1%E7%AE%97"><span class="nav-text">2. CAM 类激活热力图计算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x02-%E8%AE%A8%E8%AE%BA%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E5%85%A8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><span class="nav-text">0x02 讨论：为什么使用全卷积神经网络？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x03-%E8%AE%A8%E8%AE%BA%E5%85%A8%E5%B1%80%E5%B9%B3%E5%9D%87%E6%B1%A0%E5%8C%96-global-average-pooling"><span class="nav-text">0x03 讨论：全局平均池化 Global Average Pooling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x04-cam-%E7%B1%BB%E6%BF%80%E6%B4%BB%E7%83%AD%E5%8A%9B%E5%9B%BE%E7%9A%84%E7%9B%B8%E5%85%B3%E5%AE%9E%E9%AA%8C"><span class="nav-text">0x04 CAM 类激活热力图的相关实验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E5%BC%A0%E5%9B%BE%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%88%AB"><span class="nav-text">1. 同张图，不同类别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E5%9B%BE%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%88%AB"><span class="nav-text">2. 不同图，同一个类别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cam-%E5%BC%B1%E7%9B%91%E7%9D%A3%E5%AE%9A%E4%BD%8D"><span class="nav-text">3. CAM 弱监督定位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-cam-%E7%9A%84%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">4. 基于 CAM 的有意思的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E7%8E%B0%E5%9C%BA%E6%99%AF%E4%B8%AD%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E7%89%A9%E4%BD%93"><span class="nav-text">4.1 发现场景中有意义的物体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%B1%E7%9B%91%E7%9D%A3%E6%96%87%E5%AD%97%E6%A3%80%E6%B5%8B"><span class="nav-text">4.2 弱监督文字检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vqa%E4%BB%BB%E5%8A%A1"><span class="nav-text">4.3 VQA任务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x04-%E8%AE%A8%E8%AE%BAsqueezenet"><span class="nav-text">0x04 讨论：SqueezeNet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x05-%E8%AE%A8%E8%AE%BA%E6%98%BE%E8%91%97%E6%80%A7%E5%88%86%E6%9E%90%E7%9A%84%E6%84%8F%E4%B9%89"><span class="nav-text">0x05 讨论：显著性分析的意义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x06-%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-text">0x06 扩展阅读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#conclusion"><span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#references"><span class="nav-text">References</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="1nnoh" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">1nnoh</p><div class="site-description" itemprop="description">如常.</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/1nnoh" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;1nnoh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:jhhou.cn@gmail.com" title="E-Mail → mailto:jhhou.cn@gmail.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener external nofollow noreferrer" target="_blank"><img src="https://lib.baomitu.com/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://1nnoh.top/3H1Z906/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="1nnoh"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="1nnoh's Blog"><meta itemprop="description" content="如常."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="可解释机器学习-Task03-CAM类激活热力图 | 1nnoh's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">可解释机器学习-Task03-CAM类激活热力图</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-12-26 20:02:17" itemprop="dateCreated datePublished" datetime="2022-12-26T20:02:17+08:00">2022-12-26</time> </span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>5.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="x00-abstract">0x00 Abstract</h2><ul><li>CAM 类激活热力图：深度学习可解释性分析、显著性分析的<strong>经典之作</strong></li><li>论文：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/abs/1512.04150">Learning Deep Features for Discriminative Localization, CVPR 2016</a>，作者：周博磊</li><li>主要贡献：<strong>奠定了可解释性分析、显著性分析的基石</strong>，在此基础上衍生出了一系列的 CAM 方法。帮助我们打开了深度学习的黑箱子。</li></ul><blockquote><p>CAM 是一篇让人拍案叫绝的论文。</p></blockquote><span id="more"></span><p>衍生出的一系列基于 CAM 的方法「image from woopets(activation maps created with a pretrained Resnet-18)」： <img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252319417.png"></p><p>不同类别下，模型关注的不同区域： <img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252320982.png"></p><p><strong>CAM 算法的精妙之处：</strong> 1. 对深度学习实现可解释性分析、显著性分析 2. 可扩展性强，后续衍生出各种基于 CAM 的算法 3. 每张图片、每个类别，都能生成 CAM 热力图 4. 弱监督定位：图像分类模型解决定位问题 5. 潜在的 "注意力机制" 6. 使得 Machine Teaching 成为可能</p><h2 id="x01-cam-网络结构">0x01 CAM 网络结构</h2><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261121284.png"></p><h3 id="图像分类网络结构">1. 图像分类网络结构</h3><blockquote><p>使用全卷积神经网络，不添加池化，最后使用 GAP 取代 FC。</p></blockquote><ul><li>输入一张图片，经过若干个卷积层（无池化层），<strong>最后一个卷积层输出若干个 feature map</strong></li><li>假设以 512 个 feature map 为例，每一个 feature map 称之为一个 channel（矩阵），每一个 channel 为 14*14 的尺寸。这意味着图片经过网络，输出了 512 个特征，每一个 channel 就对应着一个特征。</li><li>以蓝色的 channel 为例，对其取一个平均值（全局平均池化 GAP 操作），对应到蓝色的圆圈。那么 512 个 channel（矩阵）得到了 512 个平均值（标量）。「GAP 在这里取代了 FC 的作用」。</li><li>最后接一个线性分类层。如果是一个 1000 分类问题，那么就得到了 1000 组权重。对于示图中的 Australian terrier 类别来说，是由加权求和获得线性分类分数 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="66.986ex" height="2.161ex" role="img" focusable="false" viewBox="0 -750 29607.7 955"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(298,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(783,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mi" transform="translate(1260,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1605,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2243.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3299.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">蓝</text></g><g data-mml-node="mi" transform="translate(4299.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">色</text></g><g data-mml-node="mi" transform="translate(5299.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">圈</text></g><g data-mml-node="mi" transform="translate(6299.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">标</text></g><g data-mml-node="mi" transform="translate(7299.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(8521.8,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(9522,0)"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mn" transform="translate(749,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mo" transform="translate(10896.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(11897,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">红</text></g><g data-mml-node="mi" transform="translate(12897,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">色</text></g><g data-mml-node="mi" transform="translate(13897,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">圈</text></g><g data-mml-node="mi" transform="translate(14897,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">标</text></g><g data-mml-node="mi" transform="translate(15897,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(17119.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(18119.4,0)"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mn" transform="translate(749,-150) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mo" transform="translate(19272,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mo" transform="translate(20050,0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(20494.7,0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(20939.3,0)"><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mo" transform="translate(21384,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(22162,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">绿</text></g><g data-mml-node="mi" transform="translate(23162,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">色</text></g><g data-mml-node="mi" transform="translate(24162,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">圈</text></g><g data-mml-node="mi" transform="translate(25162,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">标</text></g><g data-mml-node="mi" transform="translate(26162,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">量</text></g><g data-mml-node="mo" transform="translate(27384.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="msub" transform="translate(28384.4,0)"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mi" transform="translate(749,-150) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>获得。</li><li>最后将 1000 个（类别）的 logit 通过 softmax，获得 1000 个预测概率值。</li></ul><h3 id="cam-类激活热力图计算">2. CAM 类激活热力图计算</h3><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261121284.png"> &gt; 如何计算并获得热力图呢？=》<strong>线性分类权重</strong></p><p>计算 CAM 热力图的<strong>奥妙</strong>在于<strong>线性分类层的权重</strong>，每一个 feature map （channel or 矩阵）对应到一个 GAP 之后的标量（均值），<strong>那么每一个权重就代表了线性分类器对于每一个均值（代表着一个 feature map）的关注程度</strong>。</p><p>以蓝色均值举例，那么 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.339ex" xmlns="http://www.w3.org/2000/svg" width="2.608ex" height="1.342ex" role="img" focusable="false" viewBox="0 -443 1152.6 593"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mn" transform="translate(749,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>就反映了模型对于蓝色 channel（feature map）的关注程度，<strong>也就是对于该特征的关注程度</strong>。由于模型使用的是全卷积网络，所以<strong>位置信息</strong>会被保留到最后的 feature map。可以注意到图片的右下角是狗，那么在 feature map 中的右下角位置的激活值也会是很大的。因此，蓝色矩阵<strong>既保留了语义信息，又保留了位置信息</strong>，而 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.339ex" xmlns="http://www.w3.org/2000/svg" width="2.608ex" height="1.342ex" role="img" focusable="false" viewBox="0 -443 1152.6 593"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mn" transform="translate(749,-150) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></svg></mjx-container></span>权重就体现了这个 <strong>Australian terrier 类别对于该蓝色矩阵的关注程度</strong>。</p><p>=》那么将所有的 <code>权重✖️对应的矩阵</code>，就得到了该类别下的 CAM 热力图。可以看到右下角的高亮部分对应着狗的脸部。</p><blockquote><p>那么至此，为什么叫 CAM 类激活热力图也很明显了。因为是对于每一个类别的 feature map（激活而来），根据其线性分类权重，叠加计算得来。</p></blockquote><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261832616.png"></p><p>那么从原图获得一个 7✖️7 或者 14✖️14 的激活热力图，可以通过<strong>双线性插值</strong>的方法把它缩放回<strong>原图</strong>大小，变成一个高分辨率的热力图。</p><h2 id="x02-讨论为什么使用全卷积神经网络">0x02 讨论：为什么使用全卷积神经网络？</h2><blockquote><p>CAM 中没有使用池化层，而是全部使用卷积层。</p></blockquote><ul><li>池化的作用：<ol type="1"><li>减少计算量。</li><li>防止过拟合。</li><li>平移不变形（使得卷积网络对位置不敏感）</li></ol></li></ul><p>（同时也意味着丢失了空间信息）</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261839463.png"> 将大尺寸的图变为一个小尺度的图，同时又保留了关键信息。图示为最大池化。</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261841218.png"> 解释一下<strong>平移不变形</strong>：对于人脸来说，眼睛会是比较关键的特征，激活值比较大，如果人脸向左偏移了一些，通过最大池化，获得的 4✖️4 的特征图的相对位置是不变的。所以池化的引入，使得神经网络对输入的位置不敏感。即使人脸位置有偏移，也不会对结果产生很大影响。这就是平移不变性。</p><p>当然平移不变性的引入有利有弊。<strong>池化（下采样）引入了平移不变性，也意味着丢失了长宽方向的位置信息。因此在 CAM 热力图中，不使用带池化的卷积神经网络。</strong></p><h2 id="x03-讨论全局平均池化-global-average-pooling">0x03 讨论：全局平均池化 Global Average Pooling</h2><blockquote><p>为什么使用 GAP 代替 FC 呢？</p></blockquote><p>首先从作用上来讲，GAP 可以取代全连接层。<strong>GAP 相当于每一个 channel 变成了一个平均值，去代表这个 channel 或者说特征</strong>。使用全连接层则相当于将每一个 channel 展平成一维向量，从而去代表这个 channel。 <img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252349181.png"> 两者的区别： - FC：Fully Connected - 将 Feature Map 展平为长向量 - 消耗较大的计算量与参数量（512 个 Feature Map，512*14*14 个元素） - GAP：Global Average Pooling - 对每个 Feature Map（channel）取一个平均值（相当于只取出来一个数，那么总共只需要 512 个元素就可以了） - 大大减少参数量</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212252351617.png"></p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261829054.png"></p><p><strong>小结：</strong> - 全局平均池化（GAP）取代全连接层可以： - 减少参数量、防止过拟合 - 而且每个 GAP 平均值，间接代表了卷积层最后一层输出的每个 channel</p><p><strong>并且 CAM 算法中，必须有 GAP 层，否则无法计算每个 channel 的权重</strong>。如果没有 GAP 层，需把全连接层替换为 GAP 再重新训练模型。（CAM 的一个小缺陷）</p><p><strong>CAM 算法的缺点：</strong> 1. 必须得有 GAP 层，否则得修改模型结构后重新训练 2. 只能分析最后一层卷积层输出，无法分析中间层</p><p>这两个缺点如何改进？请见下一个笔记——《Grad-CAM》。</p><h2 id="x04-cam-类激活热力图的相关实验">0x04 CAM 类激活热力图的相关实验</h2><blockquote><p>下面有一些蛮有启发性的实验。 下面部分主要摘自 https://redamancy.blog.csdn.net/article/details/128337028</p></blockquote><h3 id="同张图不同类别">1. 同张图，不同类别</h3><p>由于因为 CAM 是基于分类展示的，所以被激活的区域是根据分类决定的。不同的分类，对应了不同的线性分类权重，叠加回去就得到了不同的 CAM 类激活热力图。因此对于同一张输入图片，在不同的类别下，可以获得不同的 CAM。</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261939140.png"></p><p>可以看到预测为宫殿、穹顶、教堂、祭坛、修道院类别的对应的不同关注位置。</p><h3 id="不同图同一个类别">2. 不同图，同一个类别</h3><p>我们还可以查看，不同图，同个类别的 CAM 可视化，从中我们会发现，抓取的信息为类别的主要特征，比如狗主要特征为狗头等。因此 CAM 可以打开黑箱子，解释神经网络到底在关注什么。</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261943630.png"></p><h3 id="cam-弱监督定位">3. CAM 弱监督定位</h3><blockquote><p>所谓的弱监督定位，实际上是用图像分类任务训练定位、检测、分割等任务。</p></blockquote><p>在早期的方法中，有一些比如可使用图像遮挡测试进行定位，可使用重叠图块进行预测，但是这些工作需要多次前向预测，并且是非端到端的；也可使用全局最大池化，导致只能获得边缘点，而非物体范围。</p><p>但是提出了 CAM 之后，这个方法可以使用 GAP 全局平均池化后绘制的 CAM 热力图，根据其重点关注的区域进行物体定位，只需要取连通图的 20%的区域画出框，就可以得到结果。</p><p>直观上来说，CAM 表示了神经网络较为关注的区域，并且确定了类别，所以我们就可以认为，神经网络关注的区域，应该是该类别物体的区域，在下图，可以看到该任务表现，具有比较好的性能，论文中认为 IOU 的阈值为 0.5，最后的准确率大概能达到 41%以上，比随机框的 0.5%好很多。</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261946654.png"></p><h3 id="基于-cam-的有意思的应用">4. 基于 CAM 的有意思的应用</h3><p>CAM 还可以利用在很多有意思的场景，下面列举几种。</p><h4 id="发现场景中有意义的物体">4.1 发现场景中有意义的物体</h4><p>我们可以用 CAM 可以看到场景中的一些物体，我们可以看到 CAM 关注的区域，实际上就是，对于场景有重要意义（或者说有辨识度）的区域。</p><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261948688.png"></p><h4 id="弱监督文字检测">4.2 弱监督文字检测</h4><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261950023.png"></p><h4 id="vqa任务">4.3 VQA任务</h4><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261951559.png"></p><h2 id="x04-讨论squeezenet">0x04 讨论：SqueezeNet</h2><blockquote><p>SqueezeNet 是一个轻量化的卷积神经网络，作者是韩松老师。</p></blockquote><p><img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261902349.png"></p><p>最后一个卷积层输出 1000 个 channel，对应着 1000 个类别的 CAM 图（不再是比如 512 个 channel 对应 512 个特征，而是<strong>直接对应 1000 个类别</strong>）。因此通过 GAP 之后，可以直接得到这 1000 个类别的 logit 分数，再接一个 softmax，就可以获得最终的输出概率。</p><p>感觉好暴力的操作，定义的时候怎么定义？随机将 1000 个 channel 直接对应去预测各自的类别？</p><p>因此只需要一次前向计算，取出最后一层卷积层对应的每一个类别的 channel，就直接获得了每一个类别的 CAM 热力图。 <img data-src="https://inno-figurebed.oss-cn-hangzhou.aliyuncs.com/img/202212261906387.png"></p><h2 id="x05-讨论显著性分析的意义">0x05 讨论：显著性分析的意义</h2><blockquote><p>从 Machine Learning 到 Machine Teaching</p></blockquote><p>正如 《Task-01-导论》中提到的，当 Al 可以达到甚至超越人类专家水平时，通过 CAM 等可视化手段，就可以反过来指导人类应该去关注图片的哪些部位，从而实现工艺的提升；或者应该关注鸟的哪些位置，从而实现分类。这也就是所谓的 Machine Teaching，去教、帮助人类去学习。</p><h2 id="x06-扩展阅读">0x06 扩展阅读</h2><ul><li><strong>CAM 论文主页</strong><ul><li>论文主页：https://openaccess.thecvf.com/content_cvpr_2016/html/Zhou_Learning_Deep_Features_CVPR_2016_paper.html</li><li>论文附录：http://cnnlocalization.csail.mit.edu/supp.pdf</li><li>论文官网：http://cnnlocalization.csail.mit.edu/</li><li>论文官方代码：https://github.com/zhoubolei/CAM</li></ul></li><li><strong>作者周博磊</strong><ul><li>个人主页：https://boleizhou.github.io http://people.csail.mit.edu/bzhoul</li><li>B 站：https://space.bilibili.com/511221970</li><li>知乎：https://www.zhihu.com/people/zhou-bo-lei</li><li>CVPR 2022 Tutorial: Human-Centered Al for Computer Vsion: https://human-centeredai.github.io</li><li>Network Dissection: http://netdissect.csail.mit.edu</li><li>GAN Dissection: https://gandissect.csail.mit.edu</li></ul></li><li><strong>扩展阅读</strong></li><li>OpenMMLab 公众号，类别激活热力图可视化工具介绍：公众号 OpenMMLab 回复 CAM</li><li>可解释机器学习专题精读论文清单：https://readpaper.com/user/collect/638623946528292864</li></ul><h2 id="conclusion">Conclusion</h2><ul><li>为什么要对深度学习模型做可解释性分析和显著性分析?</li><li>CAM 有哪些应用场景?<ul><li>Machine Teaching</li><li>弱监督定位</li><li>可解释性分析等等</li></ul></li><li>CAM 方法，与基于梯度和反向传播的显著性分析方法，有什么区别?</li><li>原始的 CAM 方法有什么缺点? 后续有哪些算法做了什么样的改进?<ul><li>原始方法缺点：必须要有 GAP 层；只能分析最后一层卷积层输出，无法分析中间层。</li><li>Grad-CAM</li></ul></li><li>论文中，如何用 CAM 热力图实现物体的定位? 这种定位方法的巧妙之处是什么?<ul><li>根据 CAM 关注的重要区域，连通高亮图的 20%的区域画出框。</li><li>在于标注的是分类任务，但实现了物体定位。</li></ul></li><li>如何理解 CAM 的“弱监督定位” ?<ul><li>标注的是分类任务，但实现了定位、分割等任务。</li></ul></li><li>哪些经典的图像分类网络中用到了 GAP 层?<ul><li>NIN</li></ul></li><li>GAP 层在普通卷积神经网络中的作用是什么?<ul><li>池化</li></ul></li><li>GAP 层在 CAM 中的作用是什么?<ul><li>代替 FC 层</li></ul></li><li>原生 CAM 仅用于图像分类，针对目标检测、图像分割、关键点检测等涉及位置坐标的 Dense Prediction 任务，如何进行可解释性分析和显著性分析?<ul><li>弱监督定位</li></ul></li><li>CAM 方法有哪些缺点? 如何改进?<ul><li>原始方法缺点：必须要有 GAP 层；只能分析最后一层卷积层输出，无法分析中间层。</li></ul></li></ul><h2 id="references">References</h2><ul><li>论文：<ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://readpaper.com/paper/2950328304">Learning Deep Features for Discriminative Localization-论文阅读讨论-ReadPaper</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://arxiv.org/abs/1512.04150">Learning Deep Features for Discriminative Localization</a></li></ul></li></ul><p>类别激活热力图可视化工具合集：公众号 OpenMMLab 回复 CAM （CV、NLP、强化学习都支持可视化）</p><ul><li>组队学习笔记：<ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://redamancy.blog.csdn.net/article/details/128337028">【学习打卡03】可解释机器学习笔记之CAM类激活热力图_风信子的猫Redamancy的博客-CSDN博客</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_43935969/article/details/128358960">【学习打卡】CAM可解释性分析-算法讲解_爱学习的书文的博客-CSDN博客</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://relph1119.github.io/my-team-learning/#/Interpretable_machine_learning44/task03">我的组队学习</a></li></ul></li></ul></div><footer class="post-footer"><div class="reward-container"><div>Buy me a coffee</div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="1nnoh 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="1nnoh 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>1nnoh</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://1nnoh.top/3H1Z906/" title="可解释机器学习-Task03-CAM类激活热力图">https://1nnoh.top/3H1Z906/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="post-nav"><div class="post-nav-item"><a href="/2EQN5PQ/" rel="prev" title="可解释机器学习-Task02 ZFNet 深度学习图像分类算法"><i class="fa fa-chevron-left"></i> 可解释机器学习-Task02 ZFNet 深度学习图像分类算法</a></div><div class="post-nav-item"></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">1nnoh</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">138k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">5:13</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script><script src="/js/prism/prism.js" async></script><script src="/js/prism/prism.js" async></script></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/1nnoh" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener external nofollow noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="150" alpha="0.26" zindex="-2" src="https://lib.baomitu.com/ribbon.js/1.0.2/ribbon.min.js"></script><script src="https://lib.baomitu.com/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://lib.baomitu.com/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://lib.baomitu.com/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="https://lib.baomitu.com/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous"><script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"1nnoh","repo":"1nnoh.github.io","client_id":"19227156b4ef17fefc34","client_secret":"2d052e6865196020dd941e7bacedbb7b85880af7","admin_user":"1nnoh","distraction_free_mode":true,"proxy":"https://frolicking-zabaione-1b2f6e.netlify.app/github_access_token","language":"zh-CN","js":{"url":"https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"4cf3bed51ab5326563440c5307c03feb"}</script><script src="/js/third-party/comments/gitalk.js"></script></body></html>